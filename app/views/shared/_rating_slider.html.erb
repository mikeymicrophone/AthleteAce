<%# 
  Shared rating slider component
  
  Required parameters:
  - target: The object being rated (player, team, etc.)
  - selected_spectrums: Collection of currently selected spectrums to display sliders for
  
  The spectrum picker itself is now expected to be at the page level, not within this partial.
%>

<div class="rating-slider-group-container" 
     data-controller="rating-slider" <%# Controller might need renaming or significant updates %>
     <%= "data-rating-slider-player-id-value=#{target.id}" if target.is_a?(Player) %>
     <%= "data-rating-slider-team-id-value=#{target.id}" if target.is_a?(Team) %>>

  <%# Loop through each selected spectrum and render a slider for it %>
  <% selected_spectrums.each_with_index do |spectrum, index| %>
    <div class="rating-slider-instance mb-4 border-t pt-2" data-spectrum-id="<%= spectrum.id %>">
      <div class="flex justify-between items-center mb-1">
        <span class="text-sm font-medium text-gray-700"><%= spectrum.name.sub(/\s*\(.*\)\s*$/, '').strip %></span>
        <span data-rating-slider-target="value_<%= spectrum.id %>" class="text-sm font-semibold">
          <%= target.ratings.active.find_by(spectrum_id: spectrum.id)&.value || 0 %>
        </span>
      </div>
      
      <%# Rating Slider %>
      <div class="flex items-center space-x-2">
        <span class="text-xs text-gray-500"><%= spectrum.low_label %></span>
        <input type="range" 
               min="-10000" 
               max="10000" 
               value="<%= target.ratings.active.find_by(spectrum_id: spectrum.id)&.value || 0 %>" 
               step="100" 
               class="w-full h-2 bg-blue-200 rounded-lg appearance-none cursor-pointer rating-slider-input"
               data-rating-slider-target="slider_<%= spectrum.id %>" <%# Target needs to be unique %>
               data-action="input->rating-slider#updateValue change->rating-slider#submitRating"
               data-rating-slider-spectrum-id-param="<%= spectrum.id %>"> <%# Pass spectrum_id for JS actions. CORRECTED %>
        <span class="text-xs text-gray-500"><%= spectrum.high_label %></span>
      </div>
      
      <%# Status Indicator (per slider) %>
      <div class="text-right mt-1">
        <span data-rating-slider-target="status_<%= spectrum.id %>" class="text-xs text-gray-500"></span>
      </div>
    </div>
  <% end %>

  <% if selected_spectrums.empty? %>
    <p class="text-sm text-gray-500 italic">Select a spectrum to see rating sliders.</p>
  <% end %>
</div>
