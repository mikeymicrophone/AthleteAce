<div class="container mx-auto px-4 py-8">
  <%# Flash messages %>
  <% if notice %>
    <%= tag.div class: "bg-green-100 border-l-4 border-green-500 text-green-700 p-4 mb-4", role: "alert" do %>
      <%= tag.p "Notice", class: "font-bold" %>
      <%= tag.p notice %>
    <% end %>
  <% end %>
  <% if alert %>
    <%= tag.div class: "bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-4", role: "alert" do %>
      <%= tag.p "Alert", class: "font-bold" %>
      <%= tag.p alert %>
    <% end %>
  <% end %>
  <% if flash[:error] %>
    <%= tag.div class: "bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 mb-4", role: "alert" do %>
      <%= tag.p "Error", class: "font-bold" %>
      <%= tag.p flash[:error] %>
    <% end %>
  <% end %>

  <%= tag.h1 "Guess the Division!", class: "text-3xl font-bold mb-6 text-center text-gray-700" %>

  <% if !@team || !@choices.present? %>
    <%= tag.div class: "max-w-lg mx-auto bg-white shadow-md rounded-lg p-6" do %>
      <%= tag.div class: "mb-6" do %>
        <%= tag.h2 "Select Game Difficulty", class: "text-xl font-semibold mb-3 text-gray-800" %>
        <%= tag.p "Choose your preferred difficulty level for the game:", class: "text-gray-600 mb-4" %>
        
        <%= tag.div class: "grid grid-cols-1 md:grid-cols-2 gap-4" do %>
          <%= link_to new_division_game_path(difficulty: :conference), class: "flex flex-col items-center p-4 border border-gray-300 rounded-lg hover:bg-blue-50 hover:border-blue-300 transition-colors" do %>
            <%= tag.div class: "text-blue-600 mb-2" do %>
              <i class="fas fa-trophy text-2xl"></i>
            <% end %>
            <%= tag.h3 "Conference", class: "font-medium text-lg" %>
            <%= tag.p "Guess divisions within the same conference", class: "text-sm text-gray-500 text-center mt-1" %>
          <% end %>
          
          <%= link_to new_division_game_path(difficulty: :league), class: "flex flex-col items-center p-4 border border-gray-300 rounded-lg hover:bg-blue-50 hover:border-blue-300 transition-colors" do %>
            <%= tag.div class: "text-blue-600 mb-2" do %>
              <i class="fas fa-award text-2xl"></i>
            <% end %>
            <%= tag.h3 "League", class: "font-medium text-lg" %>
            <%= tag.p "Guess divisions from the entire league", class: "text-sm text-gray-500 text-center mt-1" %>
          <% end %>
        <% end %>
      <% end %>
      
      <%= tag.p "Having trouble? Make sure your database has teams with active divisions in the same league.", class: "text-sm text-gray-500 mt-4" %>
      
      <%# Show recent attempts even on the difficulty selection screen %>
      <%= recent_division_attempts(current_ace) if current_ace %>
    <% end %>
  <% else %>
    <%# Use the division game container to wrap the game content %>
    <%= division_game_container(@team, @team.division, @choices) do %>
      <%= tag.div class: "bg-white shadow-md rounded-lg p-6 max-w-lg mx-auto" do %>
        <%= tag.div class: "flex justify-between items-center mb-4" do %>
          <%= tag.div do %>
            <%= tag.span session[:division_game_difficulty]&.titleize, class: "inline-block bg-blue-100 text-blue-800 text-xs font-semibold px-2.5 py-0.5 rounded-full mr-2" %>
            <% if @team.league %>
              <%= tag.span @team.league.name, class: "inline-block bg-gray-100 text-gray-800 text-xs font-semibold px-2.5 py-0.5 rounded-full" %>
            <% end %>
          <% end %>
          <%= link_to "Change Difficulty", new_division_game_path, class: "text-sm text-blue-600 hover:text-blue-800" %>
        <% end %>
        
        <%= tag.p class: "text-xl mb-4 text-gray-800" do %>
          Which division does
          <%= tag.strong @team.name, class: "font-semibold text-blue-600" %>
          play in?
        <% end %>
        
        <% if @sport %>
          <%= tag.p class: "text-sm text-gray-500 mb-4" do %>
            <%= tag.span "Sport: ", class: "font-medium" %>
            <%= tag.span @sport.name, class: "" %>
          <% end %>
        <% end %>

        <%= tag.div class: "division-choices-grid grid gap-3" do %>
          <% @choices.each do |division| %>
            <%= link_to create_division_game_attempt_path(guessed_division_id: division.id), 
                        method: :post,
                        class: "division-choice flex items-center p-4 border border-gray-300 rounded-lg hover:bg-blue-50 hover:border-blue-300 transition-colors cursor-pointer" do %>
              <%= tag.div class: "division-choice-content w-full" do %>
                <%= tag.div class: "flex items-center" do %>
                  <%= tag.div class: "division-icon mr-3 text-blue-600" do %>
                    <i class="fas fa-shield-alt"></i>
                  <% end %>
                  <%= tag.div class: "division-info" do %>
                    <%= tag.div division.name, class: "division-name text-lg font-medium" %>
                    <% if division.conference %>
                      <%= tag.div division.conference.name, class: "division-conference text-sm text-gray-500" %>
                    <% end %>
                  <% end %>
                <% end %>
              <% end %>
            <% end %>
          <% end %>
        <% end %>
      <% end %>
      
      <%# Add the attempts history container %>
      <%= division_attempts_history_container %>
    <% end %>
  <% end %>

  <div class="mt-8 text-center">
    <%= link_to "Back to Games", strength_path, class: "text-blue-500 hover:text-blue-700" %>
  </div>

</div>
