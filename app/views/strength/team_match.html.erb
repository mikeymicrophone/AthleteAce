<% content_for :title, @division.present? ? "#{@division.name} Division Quiz - Team Match" : "Team Match - Strength Training" %>

<%= tag.div data: { 
  controller: "team-match",
  team_match_player_id_value: @current_player.id,
  team_match_correct_team_id_value: @correct_team.id
} do %>
  <%= tag.div teams_filter_label(@parent), class: "filter-indicators mb-4" %>

  <%= turbo_frame_tag "team_match_game" do %>
    <%= tag.div class: "flex flex-col lg:flex-row lg:gap-x-8" do %>

      <%= tag.div id: "player_card_area", class: "lg:w-1/3 mb-4 lg:mb-0" do %>
        <%= tag.div class: "mb-4", data: { team_match_target: "currentPlayerCardDisplay" } do %>
          <%= player_card @current_player %>
        <% end %>
      <% end %>

      <%= tag.div class: "lg:w-2/3" do %>
        <%= tag.div id: "team_match_container", class: "team-match-container" do %>
          <%= tag.div team_choice_group(@team_choices, @correct_team.id), class: "team-match-game", data: { team_match_target: "gameContainer" } %>
          <%= tag.div id: "team_name_overlay", class: "team-name-overlay fixed inset-0 flex items-center justify-center pointer-events-none opacity-0 z-50", data: { team_match_target: "teamNameOverlay" } do %>
            <%= tag.div id: "team_name_content", class: "team-name-content text-8xl font-extrabold text-center text-white text-shadow-lg", data: { team_match_target: "teamNameText" } do %>
              <%= tag.span id: "team_name_text", data: { team_match_target: "teamNameText" } %>
            <% end %>
          <% end %>
          <%= tag.div pause_button("team-match"), id: "controls", class: "controls flex justify-between items-center mt-8", data: { team_match_target: "controls" } %>
        <% end %>
      <% end %>
    <% end %>
  <% end %>

  <!-- Progress Indicator -->
  <%= tag.div id: "progress", class: "progress" do %>
    <%= tag.span "Progress: #{tag.span("0", data: { team_match_target: "progressCounter" })} correct".html_safe, class: "text-gray-600" %>
  <% end %>
  
  <!-- Attempts History Area -->
  <%= tag.div id: "attempts", data: { team_match_target: "attemptsContainer" }, class: "mt-8 p-4 border border-gray-200 rounded-lg shadow-sm hidden" do %>
    <%= tag.h3 "Recent Attempts", class: "text-lg font-semibold mb-3 text-center text-gray-700" %>
    
    <!-- Grid for displaying attempt history -->
    <%= tag.div data: { team_match_target: "attemptsGrid" }, class: "grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4" %>
    
    <!-- Template for new attempts (hidden) -->
    <%= tag.div id: "attempt-template", class: "hidden" do %>
      <%= tag.div class: "attempt-card flex flex-col items-center border rounded-md overflow-hidden" do %>
        <!-- Team part -->
        <%= tag.div class: "team-part w-full p-2 text-center" do %>
          <%= tag.div class: "team-logo-container flex justify-center items-center h-16" do %>
            <%= tag.img class: "team-logo max-h-16 max-w-full object-contain", src: "", alt: "Team Logo" %>
          <% end %>
          <%= tag.p class: "team-name text-sm font-semibold mt-1 truncate w-full" %>
        <% end %>
        
        <!-- Player part -->
        <%= tag.div class: "player-part w-full p-2 text-center border-t" do %>
          <%= tag.div class: "player-photo-container flex justify-center items-center h-12" do %>
            <%= tag.img class: "player-photo max-h-12 max-w-full object-contain", src: "", alt: "Player Photo" %>
          <% end %>
          <%= tag.p class: "player-name text-xs font-medium mt-1 truncate w-full" %>
        <% end %>
      <% end %>
    <% end %>
  <% end %>
<% end %>
