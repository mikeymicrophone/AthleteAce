<% content_for :title, @division.present? ? "#{@division.name} Division Quiz - Team Match" : "Team Match - Strength Training" %>

<%= tag.div data: { 
  controller: "team-match",
  team_match_player_id_value: @current_player.id,
  team_match_correct_team_id_value: @correct_team.id
} do %>
  <%= tag.div teams_filter_label(@parent), class: "filter-indicators mb-4" %>

  <%= turbo_frame_tag "team_match_game" do %>
    <%= tag.div class: "flex flex-col lg:flex-row lg:gap-x-8" do %>

      <%= tag.div id: "player_card_area", class: "lg:w-1/3 mb-4 lg:mb-0" do %>
        <%= tag.div class: "mb-4", data: { team_match_target: "currentPlayerCardDisplay" } do %>
          <%= player_card @current_player %>
        <% end %>
      <% end %>

      <%= tag.div class: "lg:w-2/3" do %>
        <%= tag.div id: "team_match_container", class: "team-match-container" do %>
          <%= tag.div team_choice_group(@team_choices, @correct_team.id), class: "team-match-game", data: { team_match_target: "gameContainer" } %>
          <%= tag.div id: "team_name_overlay", class: "team-name-overlay fixed inset-0 flex items-center justify-center pointer-events-none opacity-0 z-50", data: { team_match_target: "teamNameOverlay" } do %>
            <%= tag.div id: "team_name_content", class: "team-name-content text-8xl font-extrabold text-center text-white text-shadow-lg", data: { team_match_target: "teamNameText" } do %>
              <%= tag.span id: "team_name_text", data: { team_match_target: "teamNameText" } %>
            <% end %>
          <% end %>
          <%= tag.div pause_button("team-match"), id: "controls", class: "controls flex justify-between items-center mt-8", data: { team_match_target: "controls" } %>
        <% end %>
      <% end %>
    <% end %>
  <% end %>

  <!-- Last Attempt Details Area -->
  <%= tag.div id: "progress", class: "progress" do %>
    <%= tag.span "Progress: #{tag.span("0", data: { team_match_target: "progressCounter" })} correct".html_safe, class: "text-gray-600" %>
  <% end %>
  <%= tag.div data: { team_match_target: "lastAttemptContainer" }, class: "mt-8 p-4 border border-gray-200 rounded-lg shadow-sm hidden" do %>
    <%= tag.h3 "Most Recent Attempt", class: "text-lg font-semibold mb-3 text-center text-gray-700" %>
    <%= tag.div class: "flex flex-col md:flex-row items-stretch justify-center md:gap-x-6 gap-y-4" do %>
      
      <!-- Player Display Area -->
      <%= tag.div data: { team_match_target: "lastAttemptPlayerCard" }, class: "p-3 border rounded-md w-full md:w-auto flex-shrink-0" do %>
        <!-- Player card/info will be injected here by JS -->
        <%= tag.p "Player details will appear here.", class: "text-sm text-gray-400 italic text-center" %>
      <% end %>
          
      <%= tag.div class: "flex items-center justify-center text-2xl font-semibold text-gray-500" do %>
        <%= tag.span "â†’", class: "hidden md:inline" %>
        <%= tag.span "Selected:", class: "md:hidden" %>
      <% end %>
          
      <!-- Chosen Team Display Area -->
      <%= tag.div data: { team_match_target: "lastAttemptChosenTeamDisplay" }, class: "p-3 border rounded-md text-center w-full md:w-auto flex-shrink-0" do %>
        <%= tag.img data: { team_match_target: "lastAttemptChosenTeamLogo" }, src: "", alt: "Chosen Team Logo", class: "mx-auto h-16 w-16 object-contain mb-2 hidden" %>
        <%= tag.p "Chosen team", data: { team_match_target: "lastAttemptChosenTeamLogoPlaceholder" }, class: "text-gray-500 text-sm my-2" %>
        <%= tag.p "", data: { team_match_target: "lastAttemptChosenTeamName" }, class: "text-lg font-bold" %>
      <% end %>
    <% end %>
  <% end %>
<% end %>
